# ukbDataPrep

This subfolder contains materials related to preprocessing and merging UK Biobank data.

## Folders 

- inputData contains data. As different files are input and output at different stages it also contains all intermediate files.
- helpers contains files specifying columns of the data, outcomes etc. 
- scripts contains processing scripts. 
- Lots of the processing in this section uses the `ukb_download_and_prep_template` submodule tools. 

## Processing

Columns were extracted 29.05.21 using: 
`../ukb_download_and_prep_template/download/helpers/linux_tools/ukbconv inputData/ukb41733.enc_ukb csv -ianalysisCols2705.txt` (analysisCols2705.txt can now be found in the `helpers` subfolder. 

HES files were merged on 29.05.21 using: 
`python ../ukb_download_and_prep_template/download/download_health_data/mergeHESfiles.py inputData/hesin.txt inputData/hesin_diag.txt inputData/hesin_all.csv`

A columns file was autogenerated on 01.06.21 using: 
`python ../ukb_download_and_prep_template/writeColumnsFile.py --columnsFile helpers/analysisCols2705.txt`

The columns.json file generated was subsequently moved to helpers and amended to: 
- Include multiple array indices for: 6138 (qualifications, 0-5), 6150 (vascular heart problems diagnosed by doctor, 0-3), 6153 (medication, 0-3), 6177 (medication, 0-2)
- Remove columns unavailable to us: 26429, 22040, 3581, 1498

The data was then processed using: 
`python ../ukb_download_and_prep_template/filterUKB.py inputData/ukb41733.csv -o inputData/ukb41733_recoded_010621.csv --columnsFile helpers/columns.json`

`python ../ukb_download_and_prep_template/addNewHES.py inputData/ukb41733_recoded_010621.csv inputData/hesin_all.csv inputData/participant.csv helpers/icdGroups2905.json --incident_prevalent True --date_column EndTimWear`
